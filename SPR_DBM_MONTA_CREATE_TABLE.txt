CREATE PROCEDURE SPR_DBM_MONTA_CREATE_TABLE 
(
	 @TABELA VARCHAR(150)
)

/*
	RODRIGO EDUARDO - 09/04/2013

*/
AS

IF OBJECT_ID(@TABELA) IS NOT NULL
	BEGIN
		DECLARE @CAMPO VARCHAR(MAX)
		DECLARE @SQL VARCHAR(MAX)

		SET @CAMPO = ''

		SELECT
		@CAMPO = +@CAMPO +CHAR(9)+ C.NAME +' '+ T.NAME + CASE WHEN T.NAME IN ('VARCHAR','NVARCHAR','CHAR','NCHAR') THEN '('+CAST(C.MAX_LENGTH AS VARCHAR)+')' ELSE '' END +','+ CHAR(10) 
		FROM
		SYS.COLUMNS C
		INNER JOIN SYS.TYPES T
		ON C.USER_TYPE_ID = T.USER_TYPE_ID
		WHERE
			C.OBJECT_ID = OBJECT_ID(@TABELA)


		SELECT @CAMPO = LEFT (@CAMPO,(LEN(@CAMPO) - 2))


		SELECT @SQL = 'CREATE TABLE '
		SELECT @SQL = @SQL + @TABELA 
		SELECT @SQL = @SQL + CHAR(9)+'( '+CHAR(10)
		SELECT @SQL = @SQL + @CAMPO
		SELECT @SQL = @SQL + CHAR(10)+CHAR(9) + ')'

		PRINT @SQL

	END
ELSE
	BEGIN
		PRINT ('TABELA NÃO EXISTE NO BANCO '+DB_NAME())
	END 

--EXEMPLO DE CHAMADA
--EXEC SPR_DBM_MONTA_CREATE_TABLE 'DBM_CAMPANHAS_PROSPECTS'
